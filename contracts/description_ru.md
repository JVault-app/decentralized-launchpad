## Список контрактов
- sale_admin - родительский контракт, через который деплоятся сейлы

- ico_sale - контракт сейла, на котором скапливаются TON и жетоны

- sbt_item - контракт soulbound nft, подтверждающий владение купленными жетонами

- ref_wallet - контракт для владельцев реферальных кодов, подтверждает их право на получение кэшбека с рефералов

## Что можно настроить в контрактах фаундеру
- Время начала и окончания сейла

- Базовую цену, а также особые цены для разных уровней whitelist (макс 4 уровня)

- Адреса коллекций, SBT из которых будут являться вайтлистами для сейла

- Размеры минимальной и максимальной покупок для участника сейла (с whitelist SBT или без него)

- Максимально возможное количества проданных жетонов

- Минимальный размер сборов, при недостижении которого все пользователи получат свои средтсва обратно (soft cap)

- Количество жетонов, которые будут добавлены в ликвидность (задается в процентном отношении к количеству проданных жетонов)

- Процент TON, которые будут отправлены фаундеру (остальные будут добавлены в ликвидность, за вычетом комиссии лаунчпада)

- Время первой разблокировки токенов после сейла и размер этой разблокировки в процентах

- Количество разлоков и длину одного цикла для линейного вестинга

- Различные размеры кэшбеков и скидок для пользователей, имеющих реферальные коды

- Разрешение/запрет автоматического получения собственных реферальных кодов для всех участников сейла, совершивших покупку на определенный объем, и настройка базового кэшбека для них

## Основные особенности
- В случае покупки без whitelist SBT, количество жетонов, приобретенных каждым пользователем, сохраняется в уникальном для каждого юзера контракте `sft_item.fc` (один юзер -- один контракт, вне зависимости от количества покупок). В случае покупки через whitelist SBT, для каждой WL-SBT создается отдельный контракт `sft_item.fc`, в котором сохраняются адреса покупателя и WL-SBT.

- При отправке транзакции для покупки токенов, часть условий проверяется на основном контракте (`ico_sale.fc`), а часть на контракте `sft_item.fc`, и покупка считается успешной только после подтверждения контрактом `sft_item.fc`.

- Чтобы купить токены через whitelist, пользователь должен отправить запрос "prove_ownership" на адрес SBT, владельцем которой он является

- В случае, если покупка пользователя нарушает какие-либо условия сейла (например, не соответствует суммарный объем покупок юзера, или все жетоны были проданы), отправленные тоны автоматически возвращаются ему на кошелек.

- Если реферальная система включена, то каждый пользователь после успешной покупки жетонов на достаточный объем, может получить реферальный код (задеплоить `ref_wallet.fc`). Тогда он сможет получать кэшбек с каждой покупки своих рефералов.

- Кэшбек для каждого владельца реферального кода сохраняется на уникальном для него `ref_wallet.fc`, и меняется только после подтверждения успешности покупки по данному реф-коду.

- Реф-код для каждого покупателя может быть как неизменяемым (если первая покупка была совершена по одному коду, то следующие тоже будут по нему), так и изменяесым (один пользователь может применять различные коды)

- После того, как сейл был завершен, любому пользователю достаточно отправить 0.02 TON на адрес смарт-контракт с `op::end_sale`, чтобы:
    * в случае успешного завершения сейла была автоматически добавлена ликвидность, часть собранных тонов отправлена фаундеру и лаунчпаду, а неиспользованная часть токенов сожжена
    * в случае недостижения минимального размера сборов, все жетоны были возвращены фаундеру

- В случае, если сейл был успешен, каждый пользовате может заклеймить купленные им токены в соответствии с правилами лока и вестинга, а владельцы реферальных кодов могут заклеймить свой кэшбек.

- В случае, если сейл был неуспешен, каждый пользователь может заклеймить обратно отправленные TON, а все токены, выделенные на сейл, отправляются фаундеру.

- Можно установить различный размер комисиии лаунчпада в зависимости от достигнутого объема сборов (т.е. можно заранее установить несколько вариантов комиссии для одного сейла)

## Монетизация с помощью контракта Sale admin

- Чтобы задеплоить сейл, пользователь должен отправить определенное количество жетонов на адрес `sale_admin.fc` и приложить к сообщению дату контракта сейла, который он хочет задеплоить (данные проверяются на корректность в контракте `sale_admin.fc`, и в случае неуспешной проверки все жетоны возвращаются юзеру).

- В контракте `sale_admin.fc` сохраняется переменная revenue share -- хэшмапа с соответствием адресов-участников revenue share и их долей. В качестве участников revenue share могут использоваться различные контракты, например, с автоматической конвертацией TON в JVT или с распределением комиссий среди стейкеров. 

- Контракт `sale_admin.fc` распределяет полученные жетоны в соответствии с revenue share. После этого происходит деплой токенсейл.

- После успешного завершения продаж, комиссия с каждого токенсейла отправляется на адрес `sale_admin.fc`, и далее распределяется по revenue share.

## Схема взаимодействия (TODO)
